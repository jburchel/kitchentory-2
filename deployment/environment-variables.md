# Environment Variables Configuration

This document outlines all environment variables needed for Kitchentory deployment on Vercel.

## Variable Categories

### 🔒 Required Secret Variables

These variables contain sensitive information and should be kept secure:

```bash
# Database Configuration
DATABASE_URL="postgresql://username:password@host:port/database"

# Authentication Secrets
NEXTAUTH_SECRET="your-random-32-character-secret-key-here"
NEXTAUTH_URL="https://your-app.vercel.app"

# API Keys
API_KEY="your-sensitive-api-key"
```

### 🌍 Public Variables

These variables are safe to expose to the client (prefixed with `NEXT_PUBLIC_`):

```bash
# Feature Flags
NEXT_PUBLIC_ENABLE_ANALYTICS="true"
NEXT_PUBLIC_APP_URL="https://your-app.vercel.app"

# Public Configuration
NEXT_PUBLIC_APP_NAME="Kitchentory"
NEXT_PUBLIC_APP_VERSION="1.0.0"
```

### ⚙️ System Variables

These are automatically set by Vercel or used for system configuration:

```bash
NODE_ENV="production"
VERCEL_ENV="production"
VERCEL_URL="auto-generated-by-vercel.vercel.app"
```

## Vercel Dashboard Setup

### Step 1: Access Environment Variables

1. Go to your Vercel project dashboard
2. Navigate to **Settings** → **Environment Variables**
3. You'll see three environment tabs: Production, Preview, Development

### Step 2: Add Variables by Environment

#### Production Environment

Add all variables with production values:

- Use production database URLs
- Use production API keys
- Set `NODE_ENV=production`

#### Preview Environment

Add variables for staging/preview deployments:

- Use staging database URLs
- Use test API keys
- Preview URLs are auto-generated

#### Development Environment

Add variables for local development:

- Use development database URLs
- Use development API keys
- Set `NODE_ENV=development`

### Step 3: Variable Configuration

For each variable:

1. **Name**: Enter the exact variable name (case-sensitive)
2. **Value**: Enter the variable value
3. **Environments**: Select which environments need this variable
4. **Encrypted**: All sensitive variables are automatically encrypted

## Security Best Practices

### 🛡️ Secret Management

1. **Never commit secrets to Git**
   - Use `.env.local` for local development
   - Add `.env.local` to `.gitignore`
   - Use `.env.production.example` as a template

2. **Use strong secrets**
   - Generate random secrets: `openssl rand -base64 32`
   - Use different secrets for each environment
   - Rotate secrets regularly

3. **Limit access**
   - Only necessary team members should access production secrets
   - Use Vercel team roles to control access
   - Audit secret access regularly

### 🔐 Database Security

```bash
# ❌ Bad: Insecure database URL
DATABASE_URL="postgresql://admin:password@public-db:5432/app"

# ✅ Good: Secure database URL with SSL
DATABASE_URL="postgresql://user:complex_password@secure-host:5432/db?sslmode=require"
```

### 🌐 CORS and Origins

```bash
# Configure allowed origins for API calls
NEXT_PUBLIC_ALLOWED_ORIGINS="https://your-app.vercel.app,https://your-custom-domain.com"

# CORS configuration for API routes
CORS_ORIGINS="https://your-app.vercel.app"
```

## Environment-Specific Configuration

### Production Variables

```bash
# Production Database
DATABASE_URL="postgresql://prod_user:secure_password@prod-db.example.com:5432/kitchentory_prod"

# Production Authentication
NEXTAUTH_URL="https://kitchentory.vercel.app"
NEXTAUTH_SECRET="your-production-32-char-secret"

# Production Features
NEXT_PUBLIC_ENABLE_ANALYTICS="true"
NEXT_PUBLIC_SENTRY_DSN="https://your-sentry-dsn@sentry.io/project"

# Production APIs
STRIPE_PUBLIC_KEY="pk_live_..."
STRIPE_SECRET_KEY="sk_live_..."
EMAIL_API_KEY="your_production_email_key"
```

### Staging/Preview Variables

```bash
# Staging Database
DATABASE_URL="postgresql://staging_user:password@staging-db.example.com:5432/kitchentory_staging"

# Preview URLs (auto-generated by Vercel)
NEXTAUTH_URL="https://kitchentory-git-feature-branch.vercel.app"

# Test API Keys
STRIPE_PUBLIC_KEY="pk_test_..."
STRIPE_SECRET_KEY="sk_test_..."
```

### Development Variables

```bash
# Local Database
DATABASE_URL="postgresql://localhost:5432/kitchentory_dev"

# Local Development
NEXTAUTH_URL="http://localhost:3000"
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# Development Features
NEXT_PUBLIC_ENABLE_ANALYTICS="false"
```

## Validation and Testing

### Environment Variable Validation

Create a validation function to ensure all required variables are present:

```typescript
// src/lib/env.ts
export function validateEnvironment() {
  const required = ['DATABASE_URL', 'NEXTAUTH_SECRET', 'API_KEY']

  const missing = required.filter(key => !process.env[key])

  if (missing.length > 0) {
    throw new Error(`Missing environment variables: ${missing.join(', ')}`)
  }
}
```

### Testing Environment Variables

```bash
# Test that all variables are accessible
vercel env ls

# Pull environment variables locally for testing
vercel env pull .env.local

# Test build with production-like environment
vercel build
```

## Migration and Updates

### Adding New Variables

1. Add to `.env.production.example`
2. Update Vercel dashboard
3. Update documentation
4. Deploy and test

### Updating Existing Variables

1. Update in Vercel dashboard
2. Test in preview environment
3. Deploy to production
4. Verify functionality

### Removing Variables

1. Remove from code first
2. Deploy and test
3. Remove from Vercel dashboard
4. Update documentation

## Troubleshooting

### Common Issues

1. **Variable not found**
   - Check spelling (case-sensitive)
   - Verify environment selection
   - Redeploy after adding variables

2. **Build failures**
   - Ensure all required variables are set
   - Check for typos in variable names
   - Verify variable values are correct

3. **Runtime errors**
   - Check browser console for client-side errors
   - Review server logs for server-side errors
   - Verify public variables are prefixed correctly

### Debug Commands

```bash
# List all environment variables
vercel env ls

# Pull environment variables to local file
vercel env pull .env.debug

# Check environment in deployed function
console.log('Environment:', process.env.NODE_ENV);
console.log('Vercel URL:', process.env.VERCEL_URL);
```

## Documentation Updates

When adding new environment variables:

1. Update this document
2. Update `.env.production.example`
3. Update deployment checklist
4. Update team documentation
5. Notify relevant team members
